<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Halal Finder | Find Halal Spots Near You</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <div class="logo">Halal Finder</div>
    <div class="nav-actions">
      <!-- <button class="btn-outline">Switch to Hosting</button> -->
      <img src="profile.png" alt="Profile" class="profile" />
    </div>
  </header>

  <main class="container">
    <section class="listings">
      <div class="search-bar">
        <form id="search-form">
          <input type="text" id="search-input" placeholder="Search halal spots..." />
          <button type="submit" class="search-btn">Search</button>
        </form>
      </div>

      <div class="filters">
        <button class="filter active" data-type="all">All</button>
        <button class="filter" data-type="Restaurant">Restaurant</button>
        <button class="filter" data-type="Mosque">Mosques</button>
        <button class="filter" data-type="Store">Stores</button>
      </div>

      <div id="results" class="results">
        <p class="results-info">Search to find halal spots near you...</p>
      </div>
    </section>

    <section class="map">
      <div id="map" style="height: 100vh; width: 100%; border-radius: 12px"></div>
    </section>
  </main>
  
  <script>
  let map;
  let markers = [];

   function initMap() {
     const accra = { lat: 5.6037, lng: -0.1870 };
     map = new google.maps.Map(document.getElementById("map"), {
       zoom: 12,
       center: accra,
       styles: [{ featureType: "poi.business", stylers: [{ visibility: "off" }] }],
     });

     if (navigator.geolocation){
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude,
          };
          map.setCenter(userLocation);
          new google.maps.Marker({
            position: userLocation,
            map: map,
            title: "Me",
            icon: {
              url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
            },
          });
        },
        () => {
          console.warn("Geolocation service failed. Using default location.");
        }
      );
     }

    fetchHalalSpots("");
   }
   
   async function fetchHalalSpots(query, type = "all") {
    const response = await fetch(`/api/halal?query=${encodeURIComponent(query)}`);
    const data = await response.json();
    
    const filteredData = type === "all" ? data : data.filter((spot) => spot.type === type);

    renderResults(filteredData);
  }

  function renderResults(data) {
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    markers.forEach((marker) => marker.setMap(null));
    markers = [];

    if (data.length === 0) {
      resultsDiv.innerHTML = "<p>No halal spots found.</p>";
      return;
    }

    data.forEach((place) => {
      const card = document.createElement("div");
      card.classList.add("card");
      card.innerHTML = `
        <img src="${place.image}" alt="${place.name}" />
        <div class="card-info">
          <h3>${place.name}</h3>
          <p>📍 ${place.address} • ${place.rating ?? "N/A"}⭐</p>
          <span class="tag">${place.type}</span>
        </div>
      `;
      resultsDiv.appendChild(card);

      const marker = new google.maps.Marker({
        position: { lat: parseFloat(place.lat), lng: parseFloat(place.lng) },
        map: map,
        title: place.name,
      });

      const infoWindow = new google.maps.InfoWindow({
        content: `<div style="font-weight:600;">${place.name}</div>`,
      });

      marker.addListener("click", () => infoWindow.open(map, marker));
      markers.push(marker);

      card.addEventListener("click", () => {
        map.setCenter({ lat: parseFloat(place.lat), lng: parseFloat(place.lng) });
        map.setZoom(15);
        infoWindow.open(map, marker);
      });
    });
  }

  const searchInput = document.getElementById("search-input");
  searchInput.addEventListener("input", () => {
    const query = searchInput.value.trim();
    const activeType = document.querySelector(".filter.active").dataset.type;
    fetchHalalSpots(query, activeType);
  });

  const filters = document.querySelectorAll(".filter");
  filters.forEach((button) => {
    button.addEventListener("click", () => {
      filters.forEach((btn) => btn.classList.remove("active"));
      button.classList.add("active");

      const query = searchInput.value.trim();
      const type = button.dataset.type;
      fetchHalalSpots(query, type);
    });
  });
</script>

  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDODBlM6FUZMPYPzDB5LN-aqrUoHpP1b5c&callback=initMap">
  </script>
</body>
</html>









<!-- <div class="card" data-lat="5.6037" data-lng="-0.1870">
          <img src="bistro.png" alt="Restaurant" />
          <div class="card-info">
            <h3>Bistro 22</h3>
            <p>📍 Accra • 4.8⭐ • $$</p>
            <span class="tag">Restaurant</span>
          </div>
        </div>

        <div class="card" data-lat="5.614" data-lng="-0.205">
          <img src="mosque1.png" alt="Mosque" />
          <div class="card-info">
            <h3>Ghana National Mosque</h3>
            <p>📍 Accra</p>
            <span class="tag">Mosque</span>
          </div>
        </div>

        <div class="card" data-lat="5.595" data-lng="-0.175">
          <img src="bosphorus.png" alt="Restaurant" />
          <div class="card-info">
            <h3>Bosphorous Restaurant</h3>
            <p>📍 Accra • 4.3⭐</p>
            <span class="tag">Restaurant</span>
          </div>
        </div>

        <div class="card" data-lat="6.690" data-lng="-1.630">
          <img src="dnr.png" alt="Restaurant" />
          <div class="card-info">
            <h3>DNR Turkish Restaurant</h3>
            <p>📍 Kumasi • 4.9⭐</p>
            <span class="tag">Restaurant</span>
          </div>
        </div>

        <div class="card" data-lat="5.603" data-lng="-0.192">
          <img src="capitol.png" alt="Restaurant" />
          <div class="card-info">
            <h3>Capitol Cafe and Restaurant</h3>
            <p>📍 Accra • 4.4⭐</p>
            <span class="tag">Restaurant</span>
          </div>
        </div>

        <div class="card" data-lat="5.607" data-lng="-0.183">
          <img src="shogun.png" alt="Restaurant" />
          <div class="card-info">
            <h3>Shogun</h3>
            <p>📍 Accra • 4.5⭐</p>
            <span class="tag">Restaurant</span>
          </div>
        </div>

        <div class="card" data-lat="6.687" data-lng="-1.617">
          <img src="aladin.png" alt="Restaurant" />
          <div class="card-info">
            <h3>Aladin Turkish Restaurant</h3>
            <p>📍 Kumasi • 4.1⭐</p>
            <span class="tag">Restaurant</span>
          </div>
        </div>

        <div class="card" data-lat="6.687" data-lng="-1.620">
          <img src="hfc.png" alt="Restaurant" />
          <div class="card-info">
            <h3>HFC Halal Food and Cafe</h3>
            <p>📍 Kumasi • 4.1⭐</p>
            <span class="tag">Restaurant</span>
          </div>
        </div>

        <div class="card" data-lat="9.400" data-lng="-0.840">
          <img src="ghh.png" alt="Store" />
          <div class="card-info">
            <h3>Global Halal Hub</h3>
            <p>📍 Tamale • 4.7⭐ • Affordable</p>
            <span class="tag">Store</span>
          </div> -->